<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>SPI Marine Board</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
:root {
  --bg: #020617;
  --text: #e5e7eb;
  --border: #1f2937;
  --mono: "SF Mono", Menlo, Consolas, monospace;
  --alert-red: #7f1d1d;
  --alert-yellow: #facc15;
}

body {
  margin: 0;
  height: 100vh;
  width: 100vw;
  overflow: hidden;
  background: radial-gradient(circle at top, #1e293b 0, #020617 55%);
  color: var(--text);
  font-family: var(--mono);

  display: flex;
  align-items: center;
  justify-content: center;
}

.board {
  width: 100vw;
  height: 100vh;
  padding: 5vh 5vw;
  box-sizing: border-box;

  display: grid;
  grid-template-rows: auto 1fr;
  grid-template-columns: 1fr auto;
}

/* -------------------------------
   TOP BAR: WEATHER + UPDATED
-------------------------------- */
.top-left {
  font-size: clamp(2rem, 7vh, 7rem);
  font-weight: 600;
}

.top-right {
  justify-self: end;
  font-size: clamp(1.5rem, 6vh, 6rem);
}

/* -------------------------------
   MAIN GRID (4 columns)
-------------------------------- */
.grid {
  grid-column: 1 / span 2;
  margin-top: 5vh;

  display: grid;
  grid-template-columns: 1fr 1fr 1fr 1fr;

  font-size: clamp(1.2rem, 5vh, 5rem);
  row-gap: 3vh;
  column-gap: 3vw;

  align-items: center;
}

.cell {
  white-space: nowrap;
}

/* Alerts */
.alert-red {
  background: var(--alert-red);
  color: black !important;
  padding: .3rem .4rem;
  border-radius: 6px;
  width: 100%;
  display: inline-block;
}

.alert-yellow {
  background: var(--alert-yellow);
  color: black !important;
  padding: .3rem .4rem;
  border-radius: 6px;
  width: 100%;
  display: inline-block;
}

/* Debug */
input.debug-input {
  font-family: var(--mono);
  font-size: clamp(1.5rem, 5vh, 5rem);
  width: 16vw;
  padding: .3rem .4rem;
}
</style>
</head>

<body>
<div class="board">

  <!-- TOP BAR -->
  <div class="top-left">WEATHER</div>
  <div class="top-right" id="updatedAt">LOADING…</div>

  <!-- MAIN GRID -->
  <div class="grid">

    <!-- Row 1 -->
    <div class="cell"></div>
    <div class="cell">GULF</div>
    <div class="cell">BAY</div>
    <div class="cell">TIDES: <span id="tideDate"></span></div>

    <!-- Row 2 -->
    <div class="cell"><span id="waterLabel">WATER</span></div>
    <div class="cell"><span id="gulfWater">--</span></div>
    <div class="cell"><span id="bayWater">--</span></div>
    <div class="cell">LOW: <span id="tideLow">--</span></div>

    <!-- Row 3 -->
    <div class="cell"><span id="airLabel">AIR</span></div>
    <div class="cell"><span id="gulfAir">--</span></div>
    <div class="cell"><span id="bayAir">--</span></div>
    <div class="cell">HIGH: <span id="tideHigh">--</span></div>

    <!-- Row 4 -->
    <div class="cell"><span id="windLabel">WINDS</span></div>
    <div class="cell"><span id="gulfWind">--</span></div>
    <div class="cell"><span id="bayWind">--</span></div>
    <div class="cell">SUNRISE: <span id="sunrise">--</span></div>

    <!-- Row 5 -->
    <div class="cell"><span id="seasLabel">SEAS</span></div>
    <div class="cell"><span id="gulfSeas">--</span></div>
    <div class="cell"><span id="baySeas">N/A</span></div>
    <div class="cell">SUNSET: <span id="sunset">--</span></div>

  </div>
</div>

<script>
/* ------------------------------
   Your original JS untouched
------------------------------ */

const DEBUG_MODE = false;
const WORKER_URL = "https://noisy-sun-8ce3.jhonbluebrown.workers.dev/weather";
const NOAA_TIDE_STATION = "8779750";
const LAT=26.07139,LON=-97.12872;

function pad(n){return String(n).padStart(2,"0");}
function toMil(d){return pad(d.getHours())+":"+pad(d.getMinutes());}
function toMilSec(d){return pad(d.getHours())+":"+pad(d.getMinutes())+":"+pad(d.getSeconds());}

function clearAlerts(){
  document.querySelectorAll('.alert-red,.alert-yellow')
    .forEach(el=>el.classList.remove("alert-red","alert-yellow"));
}

function mark(id,cls){
  document.getElementById(id).classList.add(cls);
}

function applyAlertLogic(w){
  clearAlerts();
  const gw=w.gulf.waterF, bw=w.bay.waterF;
  const ga=w.gulf.airF, ba=w.bay.airF;
  const seas=w.waves.waveFt;

  const waterLow=gw<60||bw<60;
  const airLow=ga<60||ba<60;

  if(waterLow){
    mark("waterLabel","alert-red");
    mark("gulfWater","alert-red");
    mark("bayWater","alert-red");
  }
  if(airLow&&!waterLow){
    mark("airLabel","alert-yellow");
    mark("gulfAir","alert-yellow");
    mark("bayAir","alert-yellow");
  }
  if(airLow&&waterLow){
    mark("airLabel","alert-red");
    mark("gulfAir","alert-red");
    mark("bayAir","alert-red");
  }

  if(w.gulf.gustKts>=25||w.bay.gustKts>=25||w.gulf.windKts>=25||w.bay.windKts>=25){
    mark("windLabel","alert-red");
    mark("gulfWind","alert-red");
    mark("bayWind","alert-red");
  }

  if(seas>=8){
    mark("seasLabel","alert-red");
    mark("gulfSeas","alert-red");
  }
  else if(seas>=6){
    mark("seasLabel","alert-yellow");
    mark("gulfSeas","alert-yellow");
  }
}

function extractWind(str){
  const parts=str.match(/(\d+)[^\d]+(\d+)/);
  return {windKts:parts?+parts[1]:0, gustKts:parts?+parts[2]:0};
}

function applyDebugAlerts(){
  const gw=parseFloat(gulfWater.value)||0;
  const bw=parseFloat(bayWater.value)||0;
  const ga=parseFloat(gulfAir.value)||0;
  const ba=parseFloat(bayAir.value)||0;
  const seas=parseFloat(gulfSeas.value)||0;

  const gWind=extractWind(gulfWind.value);
  const bWind=extractWind(bayWind.value);

  applyAlertLogic({
    gulf:{waterF:gw,airF:ga,windKts:gWind.windKts,gustKts:gWind.gustKts},
    bay:{waterF:bw,airF:ba,windKts:bWind.windKts,gustKts:bWind.gustKts},
    waves:{waveFt:seas}
  });
}

function enableDebugMode(){
  if(!DEBUG_MODE)return;
  ["gulfWater","bayWater","gulfAir","bayAir","gulfWind","bayWind","gulfSeas"]
    .forEach(id=>{
      const old=document.getElementById(id);
      const i=document.createElement("input");
      i.className="debug-input";
      i.id=id;
      i.value=old.textContent;
      i.addEventListener("input",applyDebugAlerts);
      old.replaceWith(i);
    });
  applyDebugAlerts();
}

function updateBoard(){
  if(DEBUG_MODE){
    updatedAt.textContent="DEBUG MODE";
    enableDebugMode();
    return;
  }

  fetch(WORKER_URL).then(r=>r.json()).then(w=>{
    gulf=w.gulf; bay=w.bay;

    gulfWater.textContent=gulf.waterF+"°F";
    bayWater.textContent=bay.waterF+"°F";
    gulfAir.textContent=gulf.airF+"°F";
    bayAir.textContent=bay.airF+"°F";

    gulfWind.textContent=`${gulf.windKts}-${gulf.gustKts} kts ${gulf.windDirCardinal}`;
    bayWind.textContent=`${bay.windKts}-${bay.gustKts} kts ${bay.windDirCardinal}`;

    gulfSeas.textContent=w.waves.waveFt!=null?w.waves.waveFt+" ft":"--";

    applyAlertLogic(w);
  });

  fetch(`https://api.tidesandcurrents.noaa.gov/api/prod/datagetter?product=predictions&station=${NOAA_TIDE_STATION}&date=today&interval=hilo&units=english&time_zone=lst_ldt&datum=MLLW&format=json`)
  .then(r=>r.json()).then(t=>{
    const low=t.predictions.find(x=>x.type==="L");
    const high=t.predictions.find(x=>x.type==="H");

    tideLow.textContent=low?`${toMil(new Date(low.t))} / ${(+low.v).toFixed(1)} ft`:"--";
    tideHigh.textContent=high?`${toMil(new Date(high.t))} / ${(+high.v).toFixed(1)} ft`:"--";
  });

  fetch(`https://api.sunrise-sunset.org/json?lat=${LAT}&lng=${LON}&formatted=0`)
  .then(r=>r.json()).then(s=>{
    sunrise.textContent=toMil(new Date(s.results.sunrise));
    sunset.textContent=toMil(new Date(s.results.sunset));
  });

  const now=new Date();
  updatedAt.textContent="UPDATED "+toMilSec(now)+" LCL";
  tideDate.textContent=
    pad(now.getDate())+" "+["JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"][now.getMonth()];
}

updateBoard();
setInterval(updateBoard,60000);
setInterval(()=>{
  updatedAt.textContent="UPDATED "+toMilSec(new Date())+" LCL";
},1000);
</script>

</body>
</html>
