###############################################
# NETLIFY CONFIG FOR SPI WEATHER + WAVE UPDATER
###############################################

[build]
  functions = "functions"
  publish = "public"

[build.environment]
  GITHUB_TOKEN = ""
  GITHUB_REPO = "nottbob/wave-proxy"
  GITHUB_BRANCH = "main"
  STORMGLASS_KEY = ""

###############################################
# REDIRECTS
###############################################

[[redirects]]
  from = "/weather"
  to = "/.netlify/functions/weather"
  status = 200
  force = true

[[redirects]]
  from = "/waveUpdater"
  to = "/.netlify/functions/waveUpdater"
  status = 200
  force = true

###############################################
# FUNCTION BUNDLING CONFIG
###############################################

[functions]
  node_bundler = "esbuild"
  external_node_modules = ["node-fetch", "@octokit/rest"]

###############################################
# PER-FUNCTION SETTINGS
###############################################

[functions.weather]
  timeout = 10

[functions.waveUpdater]
  timeout = 20

###############################################
# AUTOMATIC SCHEDULED RUNS (CRON)
###############################################

[[scheduled]]
  name = "waveUpdater"
  # Run at 00:00 and 12:00 in America/Chicago
  cron = "0 0,12 * * *"
  timezone = "America/Chicago"

###############################################
# REQUIRED NETLIFY PLUGIN
###############################################

[[plugins]]
  package = "@netlify/plugin-functions-install-core"
